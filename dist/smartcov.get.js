"use strict";
/// <reference path="./typings/main.d.ts" />
var plugins = require("./smartcov.plugins");
exports.percentage = function (filePathArg, format) {
    var done = plugins.Q.defer();
    var report = plugins.fs.readFileSync(filePathArg, 'utf8');
    var coveragePercentage;
    var coveragePercentageRounded;
    format = format || 'jscoverage';
    switch (format) {
        case 'lcov':
        default:
            plugins.lcovParse(report, function (err, data) {
                if (err) {
                    console.log(err);
                }
                ;
                var hit = 0;
                var found = 0;
                for (var i = 0; i < data.length; i++) {
                    hit += data[i].lines.hit;
                    found += data[i].lines.found;
                }
                coveragePercentage = (hit / found) * 100;
                coveragePercentageRounded = plugins.mathjs.round(coveragePercentage);
                done.resolve(coveragePercentageRounded);
            });
            break;
    }
    return done.promise;
};

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNtYXJ0Y292LmdldC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsNENBQTRDO0FBQzVDLElBQU8sT0FBTyxXQUFXLG9CQUFvQixDQUFDLENBQUM7QUFDcEMsa0JBQVUsR0FBRyxVQUFTLFdBQWtCLEVBQUUsTUFBYztJQUMvRCxJQUFJLElBQUksR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQzdCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxFQUFFLENBQUMsWUFBWSxDQUFDLFdBQVcsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUMxRCxJQUFJLGtCQUF5QixDQUFDO0lBQzlCLElBQUkseUJBQWdDLENBQUM7SUFDckMsTUFBTSxHQUFHLE1BQU0sSUFBSSxZQUFZLENBQUM7SUFDaEMsTUFBTSxDQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztRQUNaLEtBQUssTUFBTSxDQUFDO1FBQ1o7WUFDSSxPQUFPLENBQUMsU0FBUyxDQUFDLE1BQU0sRUFBRSxVQUFTLEdBQUcsRUFBRSxJQUFJO2dCQUN4QyxFQUFFLENBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxDQUFDO29CQUNKLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7Z0JBQ3JCLENBQUM7Z0JBQUEsQ0FBQztnQkFDRixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ1osSUFBSSxLQUFLLEdBQUcsQ0FBQyxDQUFDO2dCQUNkLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNsQyxHQUFHLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUM7b0JBQ3pCLEtBQUssSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQztnQkFDakMsQ0FBQztnQkFDRCxrQkFBa0IsR0FBRyxDQUFDLEdBQUcsR0FBRyxLQUFLLENBQUMsR0FBRyxHQUFHLENBQUM7Z0JBQ3pDLHlCQUF5QixHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ3JFLElBQUksQ0FBQyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUM1QyxDQUFDLENBQUMsQ0FBQztZQUNILEtBQUssQ0FBQztJQUNkLENBQUM7SUFDRCxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQztBQUN4QixDQUFDLENBQUMiLCJmaWxlIjoic21hcnRjb3YuZ2V0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4vdHlwaW5ncy9tYWluLmQudHNcIiAvPlxuaW1wb3J0IHBsdWdpbnMgPSByZXF1aXJlKFwiLi9zbWFydGNvdi5wbHVnaW5zXCIpO1xuZXhwb3J0IGxldCBwZXJjZW50YWdlID0gZnVuY3Rpb24oZmlsZVBhdGhBcmc6c3RyaW5nLCBmb3JtYXQ/OnN0cmluZyk6bnVtYmVyIHtcbiAgICBsZXQgZG9uZSA9IHBsdWdpbnMuUS5kZWZlcigpO1xuICAgIGxldCByZXBvcnQgPSBwbHVnaW5zLmZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aEFyZywgJ3V0ZjgnKTtcbiAgICBsZXQgY292ZXJhZ2VQZXJjZW50YWdlOm51bWJlcjtcbiAgICBsZXQgY292ZXJhZ2VQZXJjZW50YWdlUm91bmRlZDpudW1iZXI7XG4gICAgZm9ybWF0ID0gZm9ybWF0IHx8ICdqc2NvdmVyYWdlJztcbiAgICBzd2l0Y2goZm9ybWF0KSB7XG4gICAgICAgIGNhc2UgJ2xjb3YnOlxuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcGx1Z2lucy5sY292UGFyc2UocmVwb3J0LCBmdW5jdGlvbihlcnIsIGRhdGEpIHtcbiAgICAgICAgICAgICAgICBpZihlcnIpe1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgdmFyIGhpdCA9IDA7XG4gICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gMDtcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBoaXQgKz0gZGF0YVtpXS5saW5lcy5oaXQ7XG4gICAgICAgICAgICAgICAgICAgIGZvdW5kICs9IGRhdGFbaV0ubGluZXMuZm91bmQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNvdmVyYWdlUGVyY2VudGFnZSA9IChoaXQgLyBmb3VuZCkgKiAxMDA7XG4gICAgICAgICAgICAgICAgY292ZXJhZ2VQZXJjZW50YWdlUm91bmRlZCA9IHBsdWdpbnMubWF0aGpzLnJvdW5kKGNvdmVyYWdlUGVyY2VudGFnZSk7XG4gICAgICAgICAgICAgICAgZG9uZS5yZXNvbHZlKGNvdmVyYWdlUGVyY2VudGFnZVJvdW5kZWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICB9XG4gICAgcmV0dXJuIGRvbmUucHJvbWlzZTtcbn07Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
